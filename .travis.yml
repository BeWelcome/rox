language: php

git:
  depth: 3

php:
  - '7.0'

services:
  - mysql

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.npm
    - $HOME/.nvm

before_install:
  - nvm install v5.5
  - nvm use v5.5
  - gem install sass
  - phpenv config-rm xdebug.ini

install:
  - composer install --no-interaction --ignore-platform-reqs
  - npm install

before_script:
  - mysql -u root -e 'create database bewelcome_test;'
  - mysql -u root -e "GRANT ALL PRIVILEGES ON bewelcome_test.* TO 'bewelcome'@'localhost' IDENTIFIED BY 'bewelcome';"
  - mysql -u root -e 'FLUSH PRIVILEGES;'
  - cp tests/rox_local.ini.tests rox_local.ini

script:
  - ./vendor/bin/phinx migrate --configuration tests/phinx_test.php
  - ./vendor/bin/phinx seed:run --configuration tests/phinx_test.php -vvv
  - mysql -u root bewelcome_test -e "select * from members;"
  - mysql -u root bewelcome_test -e "select title, Username from community_news join members on community_news.created_by = members.id;"
  - make version
  - make
  - make build

